import plot
import numpy as np
import sys
from tkinter import *
from tkinter.ttk import Combobox
from tkinter import filedialog

np.set_printoptions(threshold=sys.maxsize)


def read_data(file_location: str):
    """
    Function to read in data from the asc files generated by GEBCO

    Parameters:
    - filename: The filename to be read

    Returns:
    A pandas dataframe of the read values
    """
    plot.plot_config.file_data = np.loadtxt(file_location, dtype=int, skiprows=6)
    return plot.plot_config.file_data


def browse_files():
    """
    Function to generate file explorer for the user and collect desired data file location

    Parameters:

    Returns:
    """
    plot.plot_config.active_file = filedialog.askopenfilename(initialdir="/",
                                                               title="Select a File",
                                                               filetypes=(("ASCII files", "*.asc"),
                                                     ("Text files", "*.txt"),
                                                     ("CSV files", "*.csv")))

    # Change label contents
    show_path_label.configure(text="File Opened: " + plot.plot_config.active_file)
    data_display.insert(END, np.array2string(read_data(plot.plot_config.active_file), separator=','))


def retrieve_coords():
    """
    Function to retrieve the Latitude and Longitude co-ordinates from the filename

    Parameters:

    Returns:
    """
    string_coords = plot.plot_config.active_file.split("/")[-1][11:][:-4].split("_")
    float_coords = []

    for coord in string_coords:
        float_coords.append(float(coord[1:]))

    plot.plot_config.start_lat = float_coords[0]
    plot.plot_config.end_lat = float_coords[1]
    plot.plot_config.start_lon = float_coords[2]
    plot.plot_config.end_lon = float_coords[3]


def set_custom_configs():
    plot.plot_config.show_axis_labels = radio_var.get()
    plot.plot_config.plot_color = combo_var.get()

# create tkinter window
window = Tk()
window.title('BathPlot')
window.geometry("1500x800")


# create widget to display selected file path
show_path_label = Label(window, text="File Opened: ", wraplength=80)

# create button widget to allow browsing file system
browse_file_button = Button(window,text="Browse Files", command=browse_files)

# create button widget to generate plot of given dataframe
generate_plot_button = Button(window, text="Generate", fg="red", relief="groove", bg="light blue", height=2, width=20,
                              command=lambda: [retrieve_coords(), set_custom_configs(), plot.generate_plot_window()])

# create prompt to request users input via radio buttons
axis_label_prompt = Label(window, text="Show axis labels?")
# create radio buttons to take the users input for customization
radio_var = IntVar()
# noinspection PyTypeChecker
axis_label_radio_true = Radiobutton(window, text="Yes", variable=radio_var, value=1)
# noinspection PyTypeChecker
axis_label_radio_false = Radiobutton(window, text="No", variable=radio_var, value=0)

# create combo box to select plot color
combo_var = StringVar()
color_list = ["seismic", "copper"]
combo_box = Combobox(window, values=color_list, textvariable=combo_var)
combo_box.set("Select plot color: ")


# render all widgets in position
data_display = Text(window, height=40, width=75, wrap=NONE)
browse_file_button.grid(column=0, row=0, padx=40, pady=5)
show_path_label.grid(column=0, row=1, columnspan=3, padx=40, pady=5)
data_display.grid(column=3, row=0, rowspan=10, padx=5, pady=5)
generate_plot_button.grid(column=10, row=10, padx=5, pady=5)

axis_label_prompt.grid(column=5, row=0, padx=5)
axis_label_radio_true.grid(column=5, row=1, padx=5)
axis_label_radio_false.grid(column=5, row=2, padx=5)

combo_box.grid(column=6, row=0, padx=5, pady=5)


if __name__ == "__main__":
    window.mainloop()
